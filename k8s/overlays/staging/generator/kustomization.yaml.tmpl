# Generated kustomization for staging branch: ${BRANCH_SLUG}
# Commit: ${COMMIT_SHA}
# Auto-generated by GitHub Actions - do not edit manually
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: beanstash-staging

resources:
  - ../../base
  - ingress.yaml
  - certificate.yaml
  - middlewares.yaml
  - secrets.yaml
  - secrets-sops.yaml

configurations:
  - kustomizeconfig.yaml

namePrefix: ${BRANCH_SLUG}-

labels:
  - pairs:
      app.kubernetes.io/instance: staging-${BRANCH_SLUG}
      branch: ${BRANCH_SLUG}
    includeSelectors: true

images:
  - name: beanstash-backend
    newName: ghcr.io/nickmous/beanstash-backend
    newTag: sha-${COMMIT_SHA}
  - name: beanstash-frontend
    newName: ghcr.io/nickmous/beanstash-frontend
    newTag: sha-${COMMIT_SHA}

configMapGenerator:
  - name: beanstash-config
    behavior: merge
    literals:
      - NEXT_PUBLIC_API_URL=https://${BRANCH_SLUG}.staging.api.beanstash.org
      - POSTGRES_HOST=${BRANCH_SLUG}-beanstash-postgres
      - SENTRY_RELEASE=sha-${COMMIT_SHA}

patches:
  - path: patches/deployment-patch.yaml
  - path: patches/frontend-deployment-patch.yaml
  - path: patches/configmap-patch.yaml
